<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BGB Token Mining</title>
  <link rel="icon" href="logo.png" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap');
    *{margin:0;padding:0;box-sizing:border-box}
    body,html{height:100%;font-family:'Orbitron',sans-serif;background:#000 url('photo_2_2025-08-05_23-57-02.jpg') no-repeat center/cover}
    .overlay{background:rgba(0,0,0,.8);min-height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:30px;text-align:center}
    h1{font-size:56px;background:linear-gradient(to right,#e60000,#ff8800);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:12px}
    p{font-size:20px;color:#fff;margin-bottom:18px}
    footer{margin-top:28px;color:#aaa;font-size:14px}
    /* Miner Card */
    .miner-card{margin-top:18px;background:rgba(255,255,255,.08);padding:20px;border-radius:20px;color:#fff;display:inline-block;max-width:700px;width:100%}
    .miner-card .hdr{font-weight:800;font-size:20px;margin-bottom:8px}
    .miner-card .row{font-size:14px;opacity:.9;margin:4px 0}
    .miner-card .acc{font-size:22px;margin:10px 0}
    .miner-card .bar{height:10px;background:#ffffff26;border-radius:999px;overflow:hidden;margin:6px 0}
    .miner-card #sm-bar{height:100%;width:0%;background:#00ff88;transition:width .3s}
    .miner-card .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .miner-card button{padding:12px 22px;background:#e60000;border-radius:10px;color:#fff;font-weight:bold;font-size:16px;box-shadow:0 0 10px #e60000;transition:.3s;border:none;cursor:pointer}
    .miner-card button:hover{background:#cc0000;transform:scale(1.05)}
    .miner-card .hint{font-size:12px;opacity:.8;margin-top:10px}
    .shares-list{font-family:monospace;font-size:12px;max-height:140px;overflow:auto;background:rgba(0,0,0,.3);padding:8px;border-radius:10px;margin-top:6px;text-align:left}
  </style>
</head>
<body>
  <div class="overlay">
    <h1>BGB Mining</h1>
    <p>⛏️ Симуляция майнинга токена <strong>BGB</strong>. После накопления ≥30 BGB запросите выплату.</p>

    <!-- Miner -->
    <div id="sim-miner" class="miner-card" aria-live="polite">
      <div class="hdr">Miner Panel</div>
      <div class="row">Wallet: <span id="sm-addr">—</span></div>
      <div class="row">Hashrate: <span id="sm-hr">—</span> • Difficulty: <span id="sm-diff">1</span></div>
      <div class="acc">Accrued: <span id="sm-acc">0.0000</span> BGB</div>
      <div class="bar"><div id="sm-bar"></div></div>
      <div class="row">Shares: <span id="sm-shares">0</span> • Last: <span id="sm-last">—</span></div>
      <div class="shares-list" id="sm-shares-list" hidden></div>
      <div class="row" id="sm-msg">Tx: —</div>
      <div class="btns">
        <button type="button" onclick="smConnect()">Connect</button>
        <button type="button" onclick="smStart()">Start</button>
        <button type="button" onclick="smStop()">Stop</button>
        <button type="button" onclick="smReset()">Reset</button>
        <button type="button" onclick="smRequest()">Request Payout (≥30 BGB)</button>
        <button type="button" onclick="smToggleShares()">Shares</button>
      </div>
      <div class="hint">
        Это имитация майнинга. После 30 BGB нажмите «Request Payout» — заявка откроется в <a href="https://t.me/Makkan1985" target="_blank">Telegram</a>.
      </div>
    </div>

    <footer>© 2025 BGB Token. Все права защищены.</footer>
  </div>

  <!-- ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.umd.min.js"></script>
  <script>
  (function(){
    const SM_KEY='bgb_sim_miner_v1';
    const BASE_RATE=5n*10n**16n; // 0.05 BGB/s
    const UNIT=30n*10n**18n;
    const MAX_SHARES=300;
    let st={addr:null,running:false,last:Date.now(),accrued:0n,diff:1,shares:[],session:cryptoHex(16)};
    function load(){try{let x=JSON.parse(localStorage.getItem(SM_KEY)||'null');if(x){st=Object.assign(st,x);if(typeof st.accrued==='string')st.accrued=BigInt(st.accrued);}}catch{}}
    function save(){try{localStorage.setItem(SM_KEY,JSON.stringify({...st,accrued:st.accrued.toString()}));}catch{}}
    function cryptoHex(n){const a=new Uint8Array(n);crypto.getRandomValues(a);return Array.from(a,x=>x.toString(16).padStart(2,'0')).join('');}
    function fmt(big,dp=4){const d=10n**18n;const i=big/d;let f=(big%d).toString().padStart(18,'0').slice(0,dp);return `${i}.${f}`;}
    function render(){document.getElementById('sm-addr').textContent=st.addr?st.addr.slice(0,6)+'…'+st.addr.slice(-4):'—';document.getElementById('sm-diff').textContent=st.diff;document.getElementById('sm-acc').textContent=fmt(st.accrued,4);let hr=Number((BASE_RATE*BigInt(st.diff))/10n**14n)/100;document.getElementById('sm-hr').textContent=`${hr.toFixed(2)} BGB/s`;let pct=Math.min(100,Number(st.accrued*100n/UNIT));document.getElementById('sm-bar').style.width=pct+'%';document.getElementById('sm-shares').textContent=st.shares.length;document.getElementById('sm-last').textContent=st.shares.length?st.shares[st.shares.length-1].h.slice(0,10)+'…':'—';let list=document.getElementById('sm-shares-list');if(!list.hasAttribute('hidden'))list.innerHTML=st.shares.slice(-50).map(s=>`<div>[${new Date(s.ts).toLocaleTimeString()}] ${s.h}</div>`).join('');}
    function tick(){if(st.running){let now=Date.now();let dt=now-st.last;if(dt>0){let rate=BASE_RATE*BigInt(st.diff);st.accrued+=rate*BigInt(Math.floor(dt/1000));st.last=now;if(Math.random()<0.4){st.shares.push({h:'0x'+cryptoHex(24),ts:now});if(st.shares.length>MAX_SHARES)st.shares=st.shares.slice(-MAX_SHARES);}save();render();}}}
    // API
    window.smConnect=async function(){if(!window.ethereum){alert('Установите MetaMask');return;}try{const prov=new ethers.BrowserProvider(window.ethereum);const signer=await prov.getSigner();st.addr=await signer.getAddress();save();render();}catch(e){alert('Ошибка подключения');}}
    window.smStart=function(){st.running=true;st.last=Date.now();save();render();}
    window.smStop=function(){st.running=false;save();render();}
    window.smReset=function(){if(confirm('Сбросить данные?')){st.accrued=0n;st.shares=[];st.last=Date.now();st.diff=1;save();render();}}
    window.smToggleShares=function(){let el=document.getElementById('sm-shares-list');if(el.hasAttribute('hidden'))el.removeAttribute('hidden');else el.setAttribute('hidden','');render();}
    window.smRequest=async function(){if(st.accrued<UNIT){alert('Нужно ≥30 BGB');return;}if(!window.ethereum){alert('Подключите MetaMask');return;}try{const prov=new ethers.BrowserProvider(window.ethereum);const signer=await prov.getSigner();const addr=await signer.getAddress();const payoutWei=st.accrued-(st.accrued%UNIT);const amountBGB=fmt(payoutWei,4);const payload={address:addr,session:st.session,amountBGB,amountWei:payoutWei.toString(),shares:st.shares.length,lastShare:st.shares.slice(-1)[0]?.h||null,ts:new Date().toISOString()};const message=`BGB Claim Request\\nAddress: ${addr}\\nSession: ${st.session}\\nAmount: ${amountBGB} BGB\\nShares: ${payload.shares}\\nTime: ${payload.ts}`;const sig=await signer.signMessage(message);const full={...payload,signature:sig};await navigator.clipboard.writeText(JSON.stringify(full,null,2));window.open(`https://t.me/share/url?url=&text=${encodeURIComponent(message+'\\n\\nSignature: '+sig)}`,'_blank');document.getElementById('sm-msg').innerHTML='Заявка сформирована. Откройте <a href=\"https://t.me/Makkan1985\" target=\"_blank\">Telegram</a> и отправьте payload.';}catch(e){alert('Ошибка запроса');console.error(e);}}
    load();render();setInterval(tick,1000);
  })();
  </script>
</body>
</html>
