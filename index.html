<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BGB Token ‚Ä¢ Mining</title>
<link rel="icon" href="logo.png"/>

<style>
  :root{--accent:#e60000;--accent2:#cc0000;--ok:#00ff88;--txt:#fff}
  *{box-sizing:border-box;margin:0;padding:0}
  body,html{
    height:100%;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif;
    background:#0b0f14 url('./bg.jpg') no-repeat center/cover;
  }
  .overlay{
    min-height:100%;display:flex;flex-direction:column;align-items:center;
    padding:24px 16px;gap:14px;
    background:radial-gradient(1000px 500px at 50% -10%,#21374733 5%,#0b0f14 60%);
  }
  h1{
    font-weight:800;font-size:44px;line-height:1;
    background:linear-gradient(90deg,#ff7a00,#ff3b3b);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-top:6px
  }
  .subtitle{color:#eaeaea;font-size:16px;margin-bottom:6px}
  .buttons{display:flex;flex-wrap:wrap;justify-content:center;gap:12px}
  .btn{
    padding:12px 20px;border:none;border-radius:12px;background:var(--accent);
    color:#fff;font-weight:700;box-shadow:0 0 10px #e60000;cursor:pointer;font-size:16px;
    text-decoration:none;display:inline-flex;align-items:center;gap:8px
  }
  .btn:hover{background:var(--accent2);transform:translateY(-1px)}

  /* –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –º–∞–π–Ω–µ—Ä–∞ */
  .miner-card{
    max-width:720px;width:100%;margin:18px auto;padding:16px 18px;
    background:rgba(0,0,0,.28);backdrop-filter:blur(4px);
    border-radius:18px;color:#fff;
  }
  .miner-card .hdr{font-weight:800;font-size:20px;margin-bottom:6px}
  .miner-card .row{font-size:14px;margin:2px 0;opacity:.95}
  .miner-card .acc{font-size:20px;margin:8px 0}
  .miner-card .bar{height:8px;background:#ffffff22;border-radius:999px;overflow:hidden;margin:6px 0}
  #sm-bar{height:100%;width:0%;background:#00ff88;transition:width .30s ease}
  .mempool{display:flex;gap:10px;flex-wrap:wrap;margin:6px 0}
  .tag{background:#131820;color:#cbd5e1;border:1px solid #2a3240;padding:4px 8px;border-radius:999px;font-size:12px}
  .miner-card .btns{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:8px}
  .miner-card .btn-red{padding:10px 18px;font-size:15px;border-radius:10px;background:var(--accent);color:#fff;border:none;box-shadow:0 0 10px #e60000;cursor:pointer}
  .miner-card .btn-red:hover{background:var(--accent2);transform:scale(1.05)}
  .list{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px;max-height:160px;overflow:auto;background:#0b0f14;border:1px solid #2a3240;padding:8px;border-radius:10px;margin-top:6px;text-align:left;color:#e5e7eb}
  footer{margin-top:20px;color:#a9b0b6;font-size:13px}

  /* –ú–æ–¥–∞–ª–∫–∞ Claim */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:50;padding:16px}
  .modal .card{max-width:680px;width:100%;background:#0f1318;border:1px solid #293241;border-radius:14px;color:#e5e7eb;padding:16px;text-align:left}
  .modal pre{max-height:360px;overflow:auto;background:#0b0f14;border-radius:10px;padding:12px;font-size:12px;color:#d1d5db}
  .modal .row{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
</style>
</head>
<body>
  <div class="overlay">
    <h1>BGB Token</h1>
    <div class="subtitle">üéÅ –ü–æ–ª—É—á–∏ <b>300 BGB</b> –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –Ω–∞ —Å–≤–æ–π –∫–æ—à–µ–ª—ë–∫</div>

    <!-- –í–µ—Ä—Ö–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ -->
    <div class="buttons">
      <a class="btn" href="https://bscscan.com/token/0xFeF80dbC16251862b82286864D77aFA08ECBcb5C" target="_blank" rel="noopener">üìÑ BSC Scan</a>
      <a class="btn" href="https://t.me/Makkan1985" target="_blank" rel="noopener">üí¨ Telegram</a>
      <button class="btn" onclick="handleMetaMask(event)">ü¶ä MetaMask</button>
      <button class="btn" onclick="handleTrust(event)">üîì Trust Wallet</button>
      <a class="btn" href="https://pancakeswap.finance/add/BNB/0xFeF80dbC16251862b82286864D77aFA08ECBcb5C?chain=bsc" target="_blank" rel="noopener">üíß Add Liquidity</a>
      <a class="btn" href="https://pancakeswap.finance/swap?chain=bsc&outputCurrency=0xFeF80dbC16251862b82286864D77aFA08ECBcb5C" target="_blank" rel="noopener">üõí Buy on PancakeSwap</a>
      <a class="btn" href="https://www.geckoterminal.com/ru/bsc/pools/0x5d498d6a3a36187e4c22c5628b0fbeb068fe405a" target="_blank" rel="noopener">üß≠ GeckoTerminal</a>
    </div>

    <!-- –ú–∞–π–Ω–µ—Ä -->
    <div id="miner" class="miner-card" aria-live="polite">
      <div class="hdr">BGB Mining</div>
      <div class="row">Wallet: <span id="sm-addr">‚Äî</span></div>
      <div class="row">Hashrate: <span id="sm-hr">‚Äî</span> ‚Ä¢ Difficulty bits: <span id="sm-bits">‚Äî</span></div>
      <div class="row">Height: <span id="sm-height">0</span> ‚Ä¢ Last block: <span id="sm-last">‚Äî</span></div>
      <div class="row">Target: <span id="sm-target">‚Äî</span> ‚Ä¢ Next retarget in: <span id="sm-retarget">‚Äî</span></div>
      <div class="row">Active miners (tabs): <span id="sm-online">1</span></div>
      <div class="mempool">
        <span class="tag">Mempool: <b id="mp-count">0</b> tx</span>
        <span class="tag">Avg fee: <b id="mp-fee">0.00</b> gwei</span>
        <span class="tag">Size: <b id="mp-size">0</b> kB</span>
      </div>
      <div class="acc">Accrued: <span id="sm-acc">0.0000</span> BGB</div>
      <div class="bar"><div id="sm-bar"></div></div>
      <div class="row" id="sm-msg">Status: ready</div>
      <div id="sm-chain" class="list" hidden></div>
      <div class="btns">
        <button type="button" class="btn-red" onclick="smConnect()">Connect</button>
        <button type="button" class="btn-red" onclick="smStart()">Start</button>
        <button type="button" class="btn-red" onclick="smStop()">Stop</button>
        <button type="button" class="btn-red" onclick="smRequest()">Request Payout (‚â•30 BGB)</button>
        <button type="button" class="btn-red" onclick="smToggleChain()">Chain</button>
      </div>
    </div>

    <!-- –ö–æ–Ω—Ç—Ä–∞–∫—Ç -->
    <div class="miner-card" style="max-width:720px">
      <div class="row">–ö–æ–Ω—Ç—Ä–∞–∫—Ç —Ç–æ–∫–µ–Ω–∞: <code>0xFeF80dbC16251862b82286864D77aFA08ECBcb5C</code></div>
    </div>

    <footer>¬© 2025 BGB Token</footer>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ Claim -->
  <div id="claim-modal" class="modal" role="dialog" aria-modal="true">
    <div class="card">
      <h3 style="margin-bottom:8px">Claim Payload</h3>
      <pre id="claim-json">{}</pre>
      <div class="row">
        <button class="btn-red" onclick="copyClaim()">Copy</button>
        <button class="btn-red" onclick="sendClaim()">Open Telegram</button>
        <button class="btn-red" onclick="closeClaim()">Close</button>
      </div>
    </div>
  </div>

  <!-- ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.umd.min.js"></script>

  <script>
  // ===== –í–µ—Ä—Ö–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –∫–æ—à–µ–ª—å–∫–æ–≤ =====
  async function handleMetaMask(e){
    e && e.preventDefault && e.preventDefault();
    const token={address:'0xFeF80dbC16251862b82286864D77aFA08ECBcb5C',symbol:'BGB',decimals:18,image:'logo.png'};
    if(window.ethereum && window.ethereum.request){
      try{ await window.ethereum.request({method:'wallet_watchAsset',params:{type:'ERC20',options:token}}); }
      catch{ alert('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ MetaMask'); }
    }else{ window.open('https://metamask.io/download/','_blank','noopener,noreferrer'); }
  }
  function handleTrust(e){
    e && e.preventDefault && e.preventDefault();
    const ua=navigator.userAgent||''; const dapp=encodeURIComponent(location.href);
    const openUrl=`https://link.trustwallet.com/open_url?source=dapp&url=${dapp}`;
    if(/Android/i.test(ua)){ location.href=openUrl; setTimeout(()=>window.open('https://play.google.com/store/apps/details?id=com.wallet.crypto.trustapp','_blank'),900); return; }
    if(/iPhone|iPad|iPod/i.test(ua)){ window.open('https://apps.apple.com/app/trust-crypto-bitcoin-wallet/id1288339409','_blank'); alert('–ù–∞ iOS –æ—Ç–∫—Ä–æ–π —Å–∞–π—Ç —á–µ—Ä–µ–∑ Trust Wallet (Browser).'); return; }
    window.open('https://trustwallet.com/download','_blank');
  }

  // ===== –ú–∞–π–Ω–µ—Ä (—Ü–µ–ø–æ—á–∫–∞, —Ä–µ—Ç–∞—Ä–≥–µ—Ç, –º–µ–º–ø—É–ª, Claim, —Å—á—ë—Ç—á–∏–∫ –≤–∫–ª–∞–¥–æ–∫) =====
  (function(){
    const KEY='bgb_miner_ui_v2';
    const GENESIS_PREV='0xf49bd1cb89367c32e3e3814b66ce02a181043f63f9af3dc1e9b5686faf15742d'; // —Å—Ç–∞—Ä—Ç–æ–≤—ã–π prev
    const UNIT=30n*10n**18n;
    const BASE_RATE=5n*10n**16n;  // 0.05 BGB/s –≤–∏–∑—É–∞–ª—å–Ω–æ
    const BLOCK_TARGET_TIME=10;   // —Å–µ–∫/–±–ª–æ–∫
    const RETARGET_INTERVAL=20;   // –±–ª–æ–∫–æ–≤ –¥–æ —Ä–µ—Ç–∞—Ä–≥–µ—Ç–∞
    const MAX_VIEW=200;

    let st={addr:null,running:false,lastMs:Date.now(),accrued:0n,bits:0x1f00ffff,height:0,chain:[],session:randId(16)};
    let mp={count:0,fee:0.0,size:0};
    let hrBase=Number(BASE_RATE/10n**14n)/100, hrJitter=0;
    let pendingClaim=null;

    // ----- —Å—á—ë—Ç—á–∏–∫ –≤–∫–ª–∞–¥–æ–∫ (–æ–Ω–ª–∞–π–Ω) -----
    const ONLINE_KEY='bgb_online_tabs_v1';
    const CH_NAME='bgb_online_broadcast_v1';
    const tabId = randId(12);
    const bc = ('BroadcastChannel' in window) ? new BroadcastChannel(CH_NAME) : null;

    function getMap(){ try{ return JSON.parse(localStorage.getItem(ONLINE_KEY)||'{}'); }catch{return{}} }
    function setMap(m){ localStorage.setItem(ONLINE_KEY, JSON.stringify(m)); }
    function cleanup(m){ const now=Date.now(); const t=15000; for(const k in m){ if((now - m[k])>t) delete m[k]; } return m; }
    function touchSelf(){
      let m = cleanup(getMap()); m[tabId]=Date.now(); setMap(m);
      const n = Object.keys(m).length; const el=document.getElementById('sm-online'); if(el) el.textContent=n;
      bc && bc.postMessage({type:'online', n});
    }
    // —Å—Ç–∞—Ä—Ç + –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π ¬´–ø–∏–Ω–≥¬ª
    touchSelf();
    setInterval(touchSelf, 5000);
    // —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ –¥—Ä—É–≥–∏—Ö –≤–∫–ª–∞–¥–æ–∫
    window.addEventListener('storage', e=>{ if(e.key===ONLINE_KEY){ const m=getMap(); const n=Object.keys(cleanup(m)).length; const el=document.getElementById('sm-online'); if(el) el.textContent=n; }});
    bc && bc.addEventListener('message', e=>{ if(e.data?.type==='online'){ const el=document.getElementById('sm-online'); if(el) el.textContent=e.data.n; }});
    // –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ ‚Äî —É–±–∏—Ä–∞–µ–º —Å–µ–±—è
    window.addEventListener('beforeunload', ()=>{ const m=getMap(); delete m[tabId]; setMap(m); bc && bc.postMessage({type:'online', n:Object.keys(m).length}); });

    // ----- —É—Ç–∏–ª–∏—Ç—ã –º–∞–π–Ω–µ—Ä–∞ -----
    const $=id=>document.getElementById(id);
    function randId(n){const a=new Uint8Array(n);crypto.getRandomValues(a);return Array.from(a,x=>x.toString(16).padStart(2,'0')).join('');}
    function fmt(big,dp=4){const d=10n**18n;const i=big/d;const f=(big%d).toString().padStart(18,'0').slice(0,dp);return `${i}.${f}`;}
    function save(){try{localStorage.setItem(KEY,JSON.stringify({...st,accrued:st.accrued.toString()}));}catch{}}
    function load(){try{const x=JSON.parse(localStorage.getItem(KEY)||'null');if(x){st=Object.assign(st,x);if(typeof st.accrued==='string')st.accrued=BigInt(st.accrued);}}catch{}}
    const k256=s=>ethers.keccak256(ethers.toUtf8Bytes(s));
    function compactToTarget(bits){const exp=(bits>>>24)&0xff;const mant=bits&0x007fffff;let t=BigInt(mant);const sh=8*(exp-3);return sh>=0?t*(1n<<BigInt(sh)):t/(1n<<BigInt(-sh));}
    function targetToCompact(t){let exp=3,n=BigInt(t);while(n>0x007fffffn){n>>=8n;exp++;}const mant=Number(n&0x007fffffn);return((exp&0xff)<<24)|mant;}
    const curTarget=()=>compactToTarget(st.bits);

    function showHashrate(){
      const el=$('sm-hr'); if(!el) return;
      hrJitter += (Math.random()-0.5)*0.1;
      hrJitter = Math.max(-0.5, Math.min(0.5, hrJitter));
      const hr = Math.max(0, hrBase * (1 + hrJitter/10));
      el.textContent = `${hr.toFixed(2)} BGB/s`;
    }

    function render(){
      if($('sm-addr')) $('sm-addr').textContent=st.addr?`${st.addr.slice(0,6)}‚Ä¶${st.addr.slice(-4)}`:'‚Äî';
      if($('sm-bits')) $('sm-bits').textContent='0x'+st.bits.toString(16);
      if($('sm-height')) $('sm-height').textContent=st.height;
      if($('sm-target')) $('sm-target').textContent='0x'+curTarget().toString(16).slice(0,16)+'‚Ä¶';
      if($('sm-acc')) $('sm-acc').textContent=fmt(st.accrued,4);
      if($('sm-last')) $('sm-last').textContent=st.height?st.chain.at(-1).hash.slice(0,10)+'‚Ä¶':'‚Äî';
      if($('sm-retarget')) $('sm-retarget').textContent=RETARGET_INTERVAL-(st.height%RETARGET_INTERVAL||RETARGET_INTERVAL);
      const pct=Math.min(100,Number(st.accrued*100n/UNIT)); if($('sm-bar')) $('sm-bar').style.width=pct+'%';
      if($('mp-count')) $('mp-count').textContent=mp.count;
      if($('mp-fee')) $('mp-fee').textContent=mp.fee.toFixed(2);
      if($('mp-size')) $('mp-size').textContent=mp.size;
      const list=$('sm-chain'); if(list && !list.hasAttribute('hidden')){
        list.innerHTML=st.chain.slice(-MAX_VIEW).map(b=>`<div>#${b.idx} t=${new Date(b.time*1000).toLocaleTimeString()} bits=0x${b.bits.toString(16)} nonce=${b.nonce}<br>${b.hash} ‚Üê ${b.prev}</div>`).reverse().join('');
      }
      showHashrate();
    }

    function mineBatch(){
      const prev = st.height ? st.chain.at(-1).hash : GENESIS_PREV;
      const target = curTarget();
      const tries = 512;
      const nowSec = Math.floor(Date.now()/1000);
      for(let i=0;i<tries;i++){
        const nonce=randId(8);
        const header=JSON.stringify({ver:1,prev,time:nowSec,bits:st.bits,nonce,merkle:randId(16)});
        const h=k256(header);
        if(BigInt(h) <= target){
          const blk={idx:st.height+1,time:nowSec,bits:st.bits,nonce,prev,hash:h};
          st.chain.push(blk); st.height=blk.idx;
          if(st.chain.length>MAX_VIEW) st.chain=st.chain.slice(-MAX_VIEW);
          if($('sm-msg')) $('sm-msg').textContent=`Mined block #${blk.idx}`;
          if(st.height % RETARGET_INTERVAL === 0) retarget();
          return true;
        }
      }
      return false;
    }

    function retarget(){
      if(st.height < RETARGET_INTERVAL) return;
      const from=st.chain.length-RETARGET_INTERVAL;
      const first=st.chain[from], last=st.chain.at(-1);
      const actual=Math.max(1, last.time-first.time);
      const span=BLOCK_TARGET_TIME*RETARGET_INTERVAL;
      const oldT=curTarget();
      let newT = oldT * BigInt(actual) / BigInt(span);
      const minT=oldT/4n, maxT=oldT*4n;
      if(newT<minT) newT=minT; if(newT>maxT) newT=maxT;
      st.bits=targetToCompact(newT);
    }

    function tick(){
      if(!st.running) return;
      const now=Date.now(), dt=now-st.lastMs; if(dt<=0) return;
      st.accrued += BASE_RATE * BigInt(Math.floor(dt/1000));
      st.lastMs = now;
      // –º–µ–º–ø—É–ª
      mp.count=Math.max(0,Math.round(mp.count+(Math.random()*6-3)));
      mp.fee=Math.max(0.1,mp.fee+(Math.random()*0.2-0.1));
      mp.size=Math.max(0,Math.round(mp.size+(Math.random()*8-4)));
      mineBatch(); save(); render();
    }

    // –ö–Ω–æ–ø–∫–∏
    window.smConnect = async function(){
      const injected = (window.__bgb_provider || window.ethereum);
      if(!injected){ alert('–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ MetaMask –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –≤ Trust Wallet DApp.'); return; }
      try{ const p=new ethers.BrowserProvider(injected); const s=await p.getSigner(); st.addr=await s.getAddress(); save(); render(); }
      catch{ alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª—ë–∫'); }
    };
    window.smStart=function(){ st.running=true; st.lastMs=Date.now(); if($('sm-msg')) $('sm-msg').textContent='Mining‚Ä¶'; save(); render(); };
    window.smStop=function(){ st.running=false; if($('sm-msg')) $('sm-msg').textContent='Paused'; save(); render(); };
    window.smToggleChain=function(){ const el=$('sm-chain'); if(!el) return; if(el.hasAttribute('hidden')) el.removeAttribute('hidden'); else el.setAttribute('hidden',''); render(); };

    // Claim
    window.smRequest = async function(){
      if(st.accrued < UNIT){ alert('–ù—É–∂–Ω–æ ‚â•30 BGB'); return; }
      const injected = (window.__bgb_provider || window.ethereum);
      if(!injected){ alert('–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫'); return; }
      try{
        const p=new ethers.BrowserProvider(injected), s=await p.getSigner(), addr=await s.getAddress();
        const payoutWei=st.accrued-(st.accrued%UNIT), amountBGB=fmt(payoutWei,4);
        const last=st.chain.at(-1);
        const payload={address:addr,session:st.session,amountBGB,amountWei:payoutWei.toString(),height:st.height,lastBlock:last?last.hash:null,bits:st.bits,ts:new Date().toISOString()};
        const msg=`BGB Claim Request\nAddress: ${addr}\nSession: ${st.session}\nAmount: ${amountBGB} BGB\nHeight: ${st.height}\nBits: 0x${st.bits.toString(16)}\nLast: ${last?last.hash:'-'}\nTime: ${payload.ts}`;
        const sig=await s.signMessage(msg);
        const claim={...payload,signature:sig,message:msg};
        // –º–æ–¥–∞–ª–∫–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        const modal=document.getElementById('claim-modal'); const pre=document.getElementById('claim-json');
        if(modal && pre){ pre.textContent=JSON.stringify(claim,null,2); modal.style.display='flex'; }
        else{
          try{ await navigator.clipboard.writeText(JSON.stringify(claim,null,2)); }catch{}
          const share=`https://t.me/share/url?url=&text=${encodeURIComponent(msg+'\n\nSignature: '+sig)}`;
          window.open(share,'_blank','noopener,noreferrer');
        }
      }catch(e){ console.error(e); alert('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞'); }
    };
    window.copyClaim=async function(){ const pre=document.getElementById('claim-json'); if(!pre) return; try{ await navigator.clipboard.writeText(pre.textContent); }catch{} };
    window.sendClaim=function(){ const pre=document.getElementById('claim-json'); if(!pre) return; try{ const obj=JSON.parse(pre.textContent); const share=`https://t.me/share/url?url=&text=${encodeURIComponent(obj.message+'\n\nSignature: '+obj.signature)}`; window.open(share,'_blank','noopener,noreferrer'); }catch{} };
    window.closeClaim=function(){ const m=document.getElementById('claim-modal'); if(m) m.style.display='none'; };

    // –°—Ç–∞—Ä—Ç
    load(); render(); setInterval(tick,500);
  })();
  </script>
</body>
</html>
