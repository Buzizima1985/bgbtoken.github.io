<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BGB Token ‚Ä¢ Mining</title>
<link rel="icon" href="logo.png"/>
<style>
  :root{
    --accent:#e60000; --accent2:#cc0000; --ok:#00ff88; --txt:#fff;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body,html{height:100%;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif;background:#0b0f14}
  .overlay{min-height:100%;background:radial-gradient(1000px 500px at 50% -10%,#21374733 5%,#0b0f14 60%);display:flex;flex-direction:column;align-items:center;padding:24px 16px;gap:14px}
  h1{font-weight:800;font-size:44px;line-height:1;background:linear-gradient(90deg,#ff7a00,#ff3b3b);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-top:6px}
  .subtitle{color:#eaeaea;font-size:16px;margin-bottom:6px}
  .buttons{display:flex;flex-wrap:wrap;justify-content:center;gap:12px}
  .btn{padding:12px 20px;border:none;border-radius:12px;background:var(--accent);color:#fff;font-weight:700;box-shadow:0 0 10px #e60000;cursor:pointer;font-size:16px;text-decoration:none;display:inline-flex;align-items:center;gap:8px}
  .btn:hover{background:var(--accent2);transform:translateY(-1px)}
  /* Miner Card */
  .miner-card{margin-top:18px;background:rgba(0,0,0,.35);backdrop-filter:blur(6px);padding:20px;border-radius:20px;color:#fff;display:inline-block;max-width:900px;width:100%}
  .miner-card .hdr{font-weight:800;font-size:20px;margin-bottom:8px}
  .miner-card .row{font-size:14px;opacity:.92;margin:4px 0}
  .miner-card .acc{font-size:22px;margin:10px 0}
  .miner-card .bar{height:10px;background:#ffffff26;border-radius:999px;overflow:hidden;margin:6px 0}
  #sm-bar{height:100%;width:0%;background:var(--ok);transition:width .3s}
  .miner-card .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .miner-card .btn-red{padding:12px 22px;background:var(--accent);border-radius:10px;color:#fff;font-weight:700;font-size:16px;box-shadow:0 0 10px #e60000;border:none;cursor:pointer}
  .miner-card .btn-red:hover{background:var(--accent2);transform:scale(1.05)}
  .list{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:12px;max-height:160px;overflow:auto;background:rgba(0,0,0,.3);padding:8px;border-radius:10px;margin-top:6px;text-align:left}
  footer{margin-top:20px;color:#a9b0b6;font-size:13px}
</style>
</head>
<body>
  <div class="overlay">
    <h1>BGB Token</h1>
    <div class="subtitle">üéÅ –ü–æ–ª—É—á–∏ <b>300 BGB</b> –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –Ω–∞ —Å–≤–æ–π –∫–æ—à–µ–ª—ë–∫</div>

    <!-- –í–µ—Ä—Ö–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ -->
    <div class="buttons">
      <a class="btn" href="https://bscscan.com/token/0xFeF80dbC16251862b82286864D77aFA08ECBcb5C" target="_blank" rel="noopener">üìÑ BSC Scan</a>
      <a class="btn" href="https://t.me/Makkan1985" target="_blank" rel="noopener">üí¨ Telegram</a>
      <button class="btn" onclick="handleMetaMask(event)">ü¶ä MetaMask</button>
      <button class="btn" onclick="handleTrust(event)">üîì Trust Wallet</button>
      <a class="btn" href="https://pancakeswap.finance/add/BNB/0xFeF80dbC16251862b82286864D77aFA08ECBcb5C?chain=bsc" target="_blank" rel="noopener">üíß Add Liquidity</a>
      <a class="btn" href="https://pancakeswap.finance/swap?chain=bsc&outputCurrency=0xFeF80dbC16251862b82286864D77aFA08ECBcb5C" target="_blank" rel="noopener">üõí Buy on PancakeSwap</a>
      <a class="btn" href="https://www.geckoterminal.com/ru/bsc/pools/0x5d498d6a3a36187e4c22c5628b0fbeb068fe405a" target="_blank" rel="noopener">üß≠ GeckoTerminal</a>
    </div>

    <!-- –ú–∞–π–Ω–µ—Ä -->
    <div id="miner" class="miner-card" aria-live="polite">
      <div class="hdr">BGB Mining</div>
      <div class="row">Wallet: <span id="sm-addr">‚Äî</span></div>
      <div class="row">Hashrate: <span id="sm-hr">‚Äî</span> ‚Ä¢ Difficulty bits: <span id="sm-bits">‚Äî</span></div>
      <div class="row">Height: <span id="sm-height">0</span> ‚Ä¢ Last block: <span id="sm-last">‚Äî</span></div>
      <div class="row">Target: <span id="sm-target">‚Äî</span> ‚Ä¢ Next retarget in: <span id="sm-retarget">‚Äî</span></div>
      <div class="acc">Accrued: <span id="sm-acc">0.0000</span> BGB</div>
      <div class="bar"><div id="sm-bar"></div></div>
      <div class="row" id="sm-msg">Status: ready</div>
      <div id="sm-chain" class="list" hidden></div>
      <div class="btns">
        <button type="button" class="btn-red" onclick="smConnect()">Connect</button>
        <button type="button" class="btn-red" onclick="smStart()">Start</button>
        <button type="button" class="btn-red" onclick="smStop()">Stop</button>
        <button type="button" class="btn-red" onclick="smReset()">Reset</button>
        <button type="button" class="btn-red" onclick="smRequest()">Request Payout (‚â•30 BGB)</button>
        <button type="button" class="btn-red" onclick="smToggleChain()">Chain</button>
      </div>
    </div>

    <!-- –ö–æ–Ω—Ç—Ä–∞–∫—Ç -->
    <div class="miner-card" style="max-width:900px">
      <div class="row">–ö–æ–Ω—Ç—Ä–∞–∫—Ç —Ç–æ–∫–µ–Ω–∞: <code id="token-address">0xFeF80dbC16251862b82286864D77aFA08ECBcb5C</code></div>
    </div>

    <footer>¬© 2025 BGB Token</footer>
  </div>

  <!-- ethers -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.umd.min.js"></script>

  <script>
  // ===== –≤–µ—Ä—Ö–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –∫–æ—à–µ–ª—å–∫–æ–≤ =====
  async function handleMetaMask(e){
    e?.preventDefault?.();
    const token={address:'0xFeF80dbC16251862b82286864D77aFA08ECBcb5C',symbol:'BGB',decimals:18,image:'logo.png'};
    if(window.ethereum?.request){
      try{ await window.ethereum.request({method:'wallet_watchAsset',params:{type:'ERC20',options:token}}); }
      catch{ alert('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ MetaMask'); }
    }else{ open('https://metamask.io/download/','_blank'); }
  }
  function handleTrust(e){
    e?.preventDefault?.();
    const ua=navigator.userAgent||''; const dapp=encodeURIComponent(location.href);
    const openUrl=`https://link.trustwallet.com/open_url?source=dapp&url=${dapp}`;
    if(/Android/i.test(ua)){ location.href=openUrl; setTimeout(()=>open('https://play.google.com/store/apps/details?id=com.wallet.crypto.trustapp','_blank'),900); return; }
    if(/iPhone|iPad|iPod/i.test(ua)){ open('https://apps.apple.com/app/trust-crypto-bitcoin-wallet/id1288339409','_blank'); alert('–û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç —á–µ—Ä–µ–∑ Trust Wallet (Browser).'); return; }
    open('https://trustwallet.com/download','_blank');
  }

  // ===== –ú–∞–π–Ω–µ—Ä (browser only) =====
  (function(){
    const KEY='bgb_miner_v1';
    const BASE_RATE=5n*10n**16n; // 0.05 BGB/s
    const UNIT=30n*10n**18n;
    const BLOCK_TARGET_TIME=10;  // s
    const RETARGET_INTERVAL=20;  // blocks
    const MAX_VIEW=200;

    let st={addr:null,running:false,lastMs:Date.now(),accrued:0n,bits:0x1f00ffff,height:0,chain:[],session:rndHex(16)};

    // utils
    const $=id=>document.getElementById(id);
    function rndHex(n){const a=new Uint8Array(n);(crypto.getRandomValues?crypto.getRandomValues(a):a.fill(0));return Array.from(a,x=>x.toString(16).padStart(2,'0')).join('');}
    function fmt(big,dp=4){const d=10n**18n;const i=big/d;const f=(big%d).toString().padStart(18,'0').slice(0,dp);return `${i}.${f}`;}
    function save(){try{localStorage.setItem(KEY,JSON.stringify({...st,accrued:st.accrued.toString()}));}catch{}}
    function load(){try{const x=JSON.parse(localStorage.getItem(KEY)||'null');if(x){st=Object.assign(st,x);if(typeof st.accrued==='string')st.accrued=BigInt(st.accrued);}}catch{}}

    // bits <-> target
    function compactToTarget(bits){const exp=(bits>>>24)&0xff;const mant=bits&0x007fffff;let t=BigInt(mant);const shift=8*(exp-3);return shift>=0?t*(1n<<BigInt(shift)):t/(1n<<BigInt(-shift));}
    function targetToCompact(t){let exp=3,n=BigInt(t);while(n>0x007fffffn){n>>=8n;exp++;}const mant=Number(n&0x007fffffn);return((exp&0xff)<<24)|mant;}
    const curTarget=()=>compactToTarget(st.bits);
    const k256=s=>ethers.keccak256(ethers.toUtf8Bytes(s));

    // render
    function render(){
      $('sm-addr').textContent=st.addr?`${st.addr.slice(0,6)}‚Ä¶${st.addr.slice(-4)}`:'‚Äî';
      $('sm-bits').textContent='0x'+st.bits.toString(16);
      $('sm-height').textContent=st.height;
      $('sm-target').textContent='0x'+curTarget().toString(16).slice(0,16)+'‚Ä¶';
      $('sm-acc').textContent=fmt(st.accrued,4);
      $('sm-last').textContent=st.height?st.chain.at(-1).hash.slice(0,10)+'‚Ä¶':'‚Äî';
      $('sm-retarget').textContent=RETARGET_INTERVAL-(st.height%RETARGET_INTERVAL||RETARGET_INTERVAL);
      const pct=Math.min(100,Number(st.accrued*100n/UNIT)); $('sm-bar').style.width=pct+'%';
      const hr=Number(BASE_RATE/10n**14n)/100; $('sm-hr').textContent=`${hr.toFixed(2)} BGB/s`;
      const list=$('sm-chain'); if(!list.hasAttribute('hidden')){
        list.innerHTML=st.chain.slice(-MAX_VIEW).map(b=>`<div>#${b.idx} t=${new Date(b.time*1000).toLocaleTimeString()} bits=0x${b.bits.toString(16)} nonce=${b.nonce}<br>${b.hash} ‚Üê ${b.prev}</div>`).reverse().join('');
      }
    }

    // mining
    function mineBatch(){
      const prev=st.height?st.chain.at(-1).hash:'0x'+'00'.repeat(32);
      const target=curTarget(); const tries=512; const nowSec=Math.floor(Date.now()/1000);
      for(let i=0;i<tries;i++){
        const nonce=rndHex(8);
        const header=JSON.stringify({ver:1,prev,time:nowSec,bits:st.bits,nonce,merkle:rndHex(16)});
        const h=k256(header);
        if(BigInt(h)<=target){
          const blk={idx:st.height+1,time:nowSec,bits:st.bits,nonce,prev,hash:h};
          st.chain.push(blk); st.height=blk.idx; if(st.chain.length>MAX_VIEW) st.chain=st.chain.slice(-MAX_VIEW);
          $('sm-msg').textContent=`Mined block #${blk.idx}`;
          if(st.height%RETARGET_INTERVAL===0) retarget();
          return true;
        }
      }
      return false;
    }
    function retarget(){
      if(st.height<RETARGET_INTERVAL) return;
      const from=st.chain.length-RETARGET_INTERVAL, first=st.chain[from], last=st.chain.at(-1);
      const actual=Math.max(1,last.time-first.time); const span=BLOCK_TARGET_TIME*RETARGET_INTERVAL;
      let newT=curTarget()*BigInt(actual)/BigInt(span);
      const cur=curTarget(), minT=cur/4n, maxT=cur*4n; if(newT<minT)newT=minT; if(newT>maxT)newT=maxT;
      st.bits=targetToCompact(newT);
    }
    function tick(){
      if(!st.running) return;
      const now=Date.now(), dt=now-st.lastMs; if(dt<=0) return;
      st.accrued+=BASE_RATE*BigInt(Math.floor(dt/1000)); st.lastMs=now;
      mineBatch(); save(); render();
    }

    // buttons
    window.smConnect=async function(){ if(!window.ethereum){alert('–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ MetaMask');return;}
      try{const p=new ethers.BrowserProvider(window.ethereum);const s=await p.getSigner();st.addr=await s.getAddress();save();render();}
      catch{alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª—ë–∫');}
    }
    window.smStart=function(){st.running=true;st.lastMs=Date.now();$('sm-msg').textContent='Mining‚Ä¶';save();render();}
    window.smStop=function(){st.running=false;$('sm-msg').textContent='Paused';save();render();}
    window.smReset=function(){if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–∞–π–Ω–µ—Ä–∞?')){st.accrued=0n;st.chain=[];st.height=0;st.lastMs=Date.now();st.bits=0x1f00ffff;$('sm-msg').textContent='Reset done';save();render();}}
    window.smToggleChain=function(){const el=$('sm-chain'); if(el.hasAttribute('hidden')) el.removeAttribute('hidden'); else el.setAttribute('hidden',''); render();}

    window.smRequest=async function(){
      if(st.accrued<UNIT){alert('–ù—É–∂–Ω–æ ‚â•30 BGB');return;}
      if(!window.ethereum){alert('–ü–æ–¥–∫–ª—é—á–∏—Ç–µ MetaMask');return;}
      try{
        const p=new ethers.BrowserProvider(window.ethereum), s=await p.getSigner(), addr=await s.getAddress();
        const payoutWei=st.accrued-(st.accrued%UNIT), amountBGB=fmt(payoutWei,4);
        const last=st.chain.at(-1);
        const payload={address:addr,session:st.session,amountBGB,amountWei:payoutWei.toString(),height:st.height,lastBlock:last?last.hash:null,bits:st.bits,ts:new Date().toISOString()};
        const msg=`BGB Claim Request\nAddress: ${addr}\nSession: ${st.session}\nAmount: ${amountBGB} BGB\nHeight: ${st.height}\nBits: 0x${st.bits.toString(16)}\nLast: ${last?last.hash:'-'}\nTime: ${payload.ts}`;
        const sig=await s.signMessage(msg);
        try{await navigator.clipboard.writeText(JSON.stringify({...payload,signature:sig},null,2));}catch{}
        open(`https://t.me/share/url?url=&text=${encodeURIComponent(msg+'\n\nSignature: '+sig)}`,'_blank','noopener,noreferrer');
        $('sm-msg').innerHTML='–ó–∞—è–≤–∫–∞ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞. –û—Ç–∫—Ä–æ–π—Ç–µ <a href="https://t.me/Makkan1985" target="_blank" rel="noopener">Telegram</a> –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ payload.';
      }catch(e){alert('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞');console.error(e);}
    }

    // init
    load(); render(); setInterval(tick,500);
  })();
  </script>
</body>
</html>
